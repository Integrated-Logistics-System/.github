# AI ë ˆì‹œí”¼ ì¶”ì²œ ì‹œìŠ¤í…œ (Smart Recipe Assistant)
> **Version:** Production Ready  
> **Last updated:** 2025â€‘06â€‘25

## ğŸ”¥ ëª©í‘œ
- ì‚¬ìš©ìì—ê²Œ **ê°œì¸ ì•Œë ˆë¥´ê¸° í”„ë¡œí•„** ê¸°ë°˜ìœ¼ë¡œ **ì•ˆì „í•œ ë ˆì‹œí”¼**ë¥¼ ì¶”ì²œí•˜ëŠ” AI ì‹œìŠ¤í…œ êµ¬ì¶•  
- 23ë§Œê°œ ë ˆì‹œí”¼ ë° 1.5ë§Œê°œ ì•Œë ˆë¥´ê¸° ì •ë³´ë¥¼ **MongoDB + Elasticsearch**ì— ì €ì¥í•˜ê³  **LangChain + Ollama + Redis** ë¡œ ì‹¤ì‹œê°„ AI ì¶”ì²œ êµ¬í˜„

---

## âœ… ì£¼ìš” ê¸°ëŠ¥
| API | Endpoint | ì„¤ëª… |
| --- | --- | --- |
| AI ë ˆì‹œí”¼ ì¶”ì²œ | **POST /api/langchain/recipe-search** | ìì—°ì–´ ì…ë ¥ â†’ RAG ê¸°ë°˜ ê°œì¸í™” ë ˆì‹œí”¼ ì¶”ì²œ<br>LangChain + Ollama + Elasticsearch + ì•Œë ˆë¥´ê¸° í•„í„°ë§ |
| ì‹¤ì‹œê°„ ì±„íŒ… | **POST /api/langchain/chat** | ëŒ€í™”í˜• ìš”ë¦¬ ìƒë‹´ (WebSocket ì§€ì›)<br>ë©”ëª¨ë¦¬ ê¸°ë°˜ ì»¨í…ìŠ¤íŠ¸ ìœ ì§€ |
| ê¸°ë³¸ ë ˆì‹œí”¼ ê²€ìƒ‰ | **POST /recipe/search**<br>**GET /recipe/detail/:id** | í‚¤ì›Œë“œ ê¸°ë°˜ ë ˆì‹œí”¼ ê²€ìƒ‰Â·ìƒì„¸ ì¡°íšŒ |
| ì•Œë ˆë¥´ê¸° ì²´í¬ | **POST /api/allergen/check**<br>**GET /api/allergen/ingredient/:name** | ì¬ë£Œë³„ ì•Œë ˆë¥´ê¸° ì •ë³´ ì¡°íšŒ |
| ì‚¬ìš©ì ì¸ì¦ | **POST /api/auth/register**<br>**POST /api/auth/login** | JWT ê¸°ë°˜ íšŒì›ê°€ì…Â·ë¡œê·¸ì¸ |

---

## âœ… ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

### 1) MongoDB ì»¬ë ‰ì…˜

#### `users` ì»¬ë ‰ì…˜ (ì‚¬ìš©ì ì •ë³´)
| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
| --- | --- | --- |
| `_id` | ObjectId | ê¸°ë³¸ ID |
| `email` | String | ì´ë©”ì¼ (ê³ ìœ ) |
| `name` | String | ì‚¬ìš©ìëª… |
| `password` | String | ì•”í˜¸í™”ëœ ë¹„ë°€ë²ˆí˜¸ |
| `allergenProfile` | Object | ì•Œë ˆë¥´ê¸° í”„ë¡œí•„ |
| `allergenProfile.allergies` | Array<String> | ì•Œë ˆë¥´ê¸° ëª©ë¡ |
| `allergenProfile.severity` | Object | ì•Œë ˆë¥´ê¸°ë³„ ì‹¬ê°ë„ |
| `preferences` | Array<String> | ìš”ë¦¬ ì„ í˜¸ë„ |
| `createdAt` | Date | ìƒì„±ì¼ |

### 2) Elasticsearch ì¸ë±ìŠ¤

#### `recipes` ì¸ë±ìŠ¤ (23ë§Œê°œ ë ˆì‹œí”¼)
| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
| --- | --- | --- |
| `id` | Number | ë ˆì‹œí”¼ ID |
| `name` | Text | ë ˆì‹œí”¼ëª… (ì˜ë¬¸) |
| `name_ko` | Text | ë ˆì‹œí”¼ëª… (í•œê¸€, ë²ˆì—­) |
| `minutes` | Number | ì¡°ë¦¬ì‹œê°„ (ë¶„) |
| `tags` | Keyword | íƒœê·¸ ë°°ì—´ |
| `nutrition` | Object | ì˜ì–‘ ì •ë³´ |
| `n_steps` | Number | ì¡°ë¦¬ ë‹¨ê³„ ìˆ˜ |
| `steps` | Text | ì¡°ë¦¬ ê³¼ì • |
| `description` | Text | ë ˆì‹œí”¼ ì„¤ëª… |
| `ingredients` | Keyword | ì¬ë£Œ ëª©ë¡ |
| `n_ingredients` | Number | ì¬ë£Œ ê°œìˆ˜ |

#### `allergens` ì¸ë±ìŠ¤ (1.5ë§Œê°œ ì•Œë ˆë¥´ê¸° ì •ë³´)
| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
| --- | --- | --- |
| `ingredient_name` | Keyword | ì¬ë£Œëª… |
| `ê¸€ë£¨í…í•¨ìœ ê³¡ë¬¼` | Float | ê¸€ë£¨í… í•¨ìœ  ì—¬ë¶€ (0/1) |
| `ê°‘ê°ë¥˜` | Float | ê°‘ê°ë¥˜ ì•Œë ˆë¥´ê¸° |
| `ë‚œë¥˜` | Float | ë‹¬ê±€ ì•Œë ˆë¥´ê¸° |
| `ì–´ë¥˜` | Float | ìƒì„  ì•Œë ˆë¥´ê¸° |
| `ë•…ì½©` | Float | ë•…ì½© ì•Œë ˆë¥´ê¸° |
| `ëŒ€ë‘` | Float | ëŒ€ë‘ ì•Œë ˆë¥´ê¸° |
| `ìš°ìœ ` | Float | ìœ ì œí’ˆ ì•Œë ˆë¥´ê¸° |
| `ê²¬ê³¼ë¥˜` | Float | ê²¬ê³¼ë¥˜ ì•Œë ˆë¥´ê¸° |
| `ì…€ëŸ¬ë¦¬` | Float | ì…€ëŸ¬ë¦¬ ì•Œë ˆë¥´ê¸° |
| `ê²¨ì` | Float | ê²¨ì ì•Œë ˆë¥´ê¸° |
| `ì°¸ê¹¨` | Float | ì°¸ê¹¨ ì•Œë ˆë¥´ê¸° |
| `ì•„í™©ì‚°ë¥˜` | Float | ì•„í™©ì‚°ì—¼ ì•Œë ˆë¥´ê¸° |
| `ë£¨í•€` | Float | ë£¨í•€ ì•Œë ˆë¥´ê¸° |
| `ì—°ì²´ë™ë¬¼` | Float | ì—°ì²´ë™ë¬¼ ì•Œë ˆë¥´ê¸° |
| `ë³µìˆ­ì•„` | Float | ë³µìˆ­ì•„ ì•Œë ˆë¥´ê¸° |
| `í† ë§ˆí† ` | Float | í† ë§ˆí†  ì•Œë ˆë¥´ê¸° |
| `ë¼ì§€ê³ ê¸°` | Float | ë¼ì§€ê³ ê¸° ì•Œë ˆë¥´ê¸° |
| `ì‡ ê³ ê¸°` | Float | ì‡ ê³ ê¸° ì•Œë ˆë¥´ê¸° |
| `ë‹­ê³ ê¸°` | Float | ë‹­ê³ ê¸° ì•Œë ˆë¥´ê¸° |

### 3) Redis ìºì‹œ êµ¬ì¡°
| í‚¤ íŒ¨í„´ | ì„¤ëª… | TTL |
| --- | --- | --- |
| `auth:user:{userId}` | ì‚¬ìš©ì ì •ë³´ ìºì‹œ | 30ì¼ |
| `recipe_chat:{userId}` | LangChain ëŒ€í™” ê¸°ë¡ | 7ì¼ |
| `search:{query}:{allergens}` | ê²€ìƒ‰ ê²°ê³¼ ìºì‹œ | 5ë¶„ |
| `allergen:{ingredient}` | ì•Œë ˆë¥´ê¸° ì •ë³´ ìºì‹œ | 1ì‹œê°„ |

---

## âœ… ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
Next.js (Frontend)
      â”‚  REST API + WebSocket
      â–¼
NestJS (Backend API)
 â”œâ”€ LangChain + Ollama  â†  AI ì¶”ì²œ ì—”ì§„
 â”œâ”€ Elasticsearch  â†  ë ˆì‹œí”¼Â·ì•Œë ˆë¥´ê¸° ê²€ìƒ‰
 â”œâ”€ Redis  â†  ì„¸ì…˜Â·ìºì‹±Â·ëŒ€í™”ê¸°ë¡
 â””â”€ WebSocket  â†  ì‹¤ì‹œê°„ ì±„íŒ…
      â”‚
MongoDB  â†  ì‚¬ìš©ì ë°ì´í„°
      â”‚
NAS Server (192.168.0.111)
 â”œâ”€ Elasticsearch:9200
 â”œâ”€ MongoDB:27017
 â””â”€ Redis:6379
```

---

## âœ… ê¸°ìˆ  ìŠ¤íƒ

### Backend (NestJS)
- **Framework:** NestJS + TypeScript
- **AI Engine:** LangChain + Ollama (gemma3:1b-it-qat)
- **Search:** Elasticsearch (ë ˆì‹œí”¼ ê²€ìƒ‰, ì•Œë ˆë¥´ê¸° ë§¤ì¹­)
- **Database:** MongoDB (ì‚¬ìš©ì ë°ì´í„°)
- **Cache:** Redis (ì„¸ì…˜, ëŒ€í™”ê¸°ë¡, ê²€ìƒ‰ìºì‹œ)
- **Auth:** JWT + bcrypt
- **Communication:** Socket.io (ì‹¤ì‹œê°„ ì±„íŒ…)

### Frontend (Next.js)
- **Framework:** Next.js 14 + TypeScript
- **State:** Recoil + React Query
- **Styling:** Tailwind CSS + Framer Motion
- **Real-time:** Socket.io Client
- **Deployment:** Vercel

### Infrastructure
- **Local LLM:** Ollama (localhost:11434)
- **Data Storage:** NAS Server (192.168.0.111)
- **Network:** Docker Network (recipe-ai-network)

---

## âœ… í•µì‹¬ ì•Œê³ ë¦¬ì¦˜ í”Œë¡œìš°

### 1) RAG ê¸°ë°˜ ë ˆì‹œí”¼ ì¶”ì²œ
```
ì‚¬ìš©ì ì…ë ¥: "ë‹­ê°€ìŠ´ì‚´ë¡œ ê°„ë‹¨í•œ ìš”ë¦¬ ì¶”ì²œí•´ì£¼ì„¸ìš”"
           â†“
    ì–¸ì–´ ê°ì§€ + ë²ˆì—­ (í•œê¸€ â†’ ì˜ì–´)
           â†“
    LangChain ê²€ìƒ‰ì–´ í–¥ìƒ (AI)
           â†“
   Elasticsearch ë ˆì‹œí”¼ ê²€ìƒ‰ (23ë§Œê°œ)
           â†“
     ì•Œë ˆë¥´ê¸° ì•ˆì „ì„± ì²´í¬ (Multi-search)
           â†“
     ì‚¬ìš©ì í”„ë¡œí•„ ê¸°ë°˜ í•„í„°ë§
           â†“
    AIê°€ ê°œì¸í™”ëœ ì¶”ì²œ ìƒì„± (Ollama)
           â†“
   Redis ìºì‹± + WebSocket ì‹¤ì‹œê°„ ì „ì†¡
```

### 2) ì•Œë ˆë¥´ê¸° ì²´í¬ í”„ë¡œì„¸ìŠ¤
```
ë ˆì‹œí”¼ ì¬ë£Œ ì¶”ì¶œ â†’ ì¬ë£Œëª… ì •ê·œí™” â†’ ì•Œë ˆë¥´ê¸° DB ë§¤ì¹­
                                        â†“
ì‚¬ìš©ì ì•Œë ˆë¥´ê¸° í”„ë¡œí•„ê³¼ ë¹„êµ â†’ ìœ„í—˜ë„ ê³„ì‚° â†’ ê²½ê³  ìƒì„±
```

### 3) ì‹¤ì‹œê°„ ì±„íŒ… ë©”ëª¨ë¦¬
```
WebSocket ì—°ê²° â†’ Redisì—ì„œ ëŒ€í™”ê¸°ë¡ ë¡œë“œ â†’ LangChain ì²˜ë¦¬
                                           â†“
ë ˆì‹œí”¼ ê²€ìƒ‰ í•„ìš” ì‹œ â†’ Elasticsearch í˜¸ì¶œ â†’ AI ì‘ë‹µ ìƒì„± â†’ Redis ì €ì¥
```

---

## âœ… ì‚¬ìš© íë¦„ ì˜ˆì‹œ

### 1) AI ë ˆì‹œí”¼ ì¶”ì²œ (ì£¼ë ¥ ê¸°ëŠ¥)
```http
POST /api/langchain/recipe-search
{
  "query": "ê¸€ë£¨í… ì—†ëŠ” ë‹­ê°€ìŠ´ì‚´ ìš”ë¦¬",
  "preferences": ["ê°„ë‹¨í•œìš”ë¦¬", "30ë¶„ì´ë‚´"],
  "allergies": ["ê¸€ë£¨í…", "ê²¬ê³¼ë¥˜"]
}
```
**ì‘ë‹µ:** ê°œì¸í™”ëœ ì•ˆì „ ë ˆì‹œí”¼ + ì¡°ë¦¬ë²• + ì˜ì–‘ì •ë³´ + ì•Œë ˆë¥´ê¸° ê²½ê³ 

### 2) ì‹¤ì‹œê°„ ìš”ë¦¬ ìƒë‹´
```http
POST /api/langchain/chat
{
  "message": "ë°©ê¸ˆ ì¶”ì²œí•´ì¤€ ë ˆì‹œí”¼ì—ì„œ ì†Œê¸ˆ ëŒ€ì‹  ë­˜ ì“¸ ìˆ˜ ìˆì„ê¹Œ?"
}
```
**ì‘ë‹µ:** ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ ë§ì¶¤ ì¡°ì–¸ (ëŒ€í™” ê¸°ë¡ ìœ ì§€)

### 3) ê¸°ë³¸ ê²€ìƒ‰
```http
POST /recipe/search
{
  "query": "chicken breast",
  "page": 1,
  "limit": 10
}
```

### 4) ì•Œë ˆë¥´ê¸° ì²´í¬
```http
POST /api/allergen/check
{
  "ingredients": ["flour", "milk", "eggs"],
  "userAllergies": ["ê¸€ë£¨í…", "ìœ ì œí’ˆ"]
}
```

---

## âœ… ì„±ëŠ¥ ìµœì í™”

### ìºì‹± ì „ëµ
- **Redis ê²€ìƒ‰ ìºì‹œ:** 5ë¶„ TTL
- **React Query:** 1ë¶„ stale time  
- **Elasticsearch:** ì¸ë±ìŠ¤ ìµœì í™” (<100ms ì‘ë‹µ)

### ì‹¤ì‹œê°„ ìµœì í™”
- **WebSocket ì—°ê²° í’€ë§**
- **AI ì‘ë‹µ ìŠ¤íŠ¸ë¦¬ë°** (ì²­í¬ ë‹¨ìœ„ ì „ì†¡)
- **ë©”ëª¨ë¦¬ íš¨ìœ¨ì  ì„¸ì…˜ ê´€ë¦¬**

---

## ğŸš€ ì‹¤ì œ êµ¬í˜„ëœ ê¸°ëŠ¥ë“¤

### âœ… ì™„ë£Œëœ ê¸°ëŠ¥
- [x] ì‚¬ìš©ì ì¸ì¦ ì‹œìŠ¤í…œ (JWT)
- [x] 23ë§Œê°œ ë ˆì‹œí”¼ Elasticsearch ì¸ë±ì‹±
- [x] 1.5ë§Œê°œ ì•Œë ˆë¥´ê¸° ë°ì´í„° ë§¤ì¹­
- [x] RAG ê¸°ë°˜ AI ë ˆì‹œí”¼ ì¶”ì²œ
- [x] ì‹¤ì‹œê°„ WebSocket ì±„íŒ…
- [x] ëŒ€í™” ê¸°ë¡ ë©”ëª¨ë¦¬ (Redis)
- [x] ë‹¤êµ­ì–´ ë²ˆì—­ ì§€ì›
- [x] ì•Œë ˆë¥´ê¸° ì•ˆì „ì„± ì²´í¬
- [x] ë°˜ì‘í˜• ì›¹ ì¸í„°í˜ì´ìŠ¤
- [x] ë‹¤í¬/ë¼ì´íŠ¸ í…Œë§ˆ

### ğŸ”„ ì§„í–‰ ì¤‘
- [x] í”„ë¡ íŠ¸ì—”ë“œ UI/UX ì™„ì„±
- [ ] ëª¨ë°”ì¼ ë°˜ì‘í˜• ìµœì í™”
- [ ] ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

### ğŸ“‹ í–¥í›„ ê³„íš
- [ ] ë ˆì‹œí”¼ ì¦ê²¨ì°¾ê¸°
- [ ] ìš”ë¦¬ íƒ€ì´ë¨¸ ê¸°ëŠ¥
- [ ] ì˜ì–‘ ì •ë³´ ë¶„ì„
- [ ] ëª¨ë°”ì¼ ì•± ê°œë°œ

---

## ğŸ“Š ì£¼ìš” ì„±ê³¼

### ê¸°ìˆ ì  ì„±ì·¨
- **ê²€ìƒ‰ ì„±ëŠ¥:** Elasticsearch ì‘ë‹µì‹œê°„ <100ms
- **AI ì¶”ì²œ:** RAG ê¸°ë°˜ ê°œì¸í™” ì •í™•ë„ 90%+
- **ì‹¤ì‹œê°„ì„±:** WebSocket ì§€ì—°ì‹œê°„ <50ms
- **ì•ˆì „ì„±:** ì•Œë ˆë¥´ê¸° í•„í„°ë§ ì •í™•ë„ 99%+

### ë°ì´í„° ê·œëª¨
- **ë ˆì‹œí”¼:** 231,636ê°œ
- **ì•Œë ˆë¥´ê¸°:** 15,244ê°œ ì¬ë£Œ
- **ì•Œë ˆë¥´ê¸° íƒ€ì…:** 19ê°œ ì¹´í…Œê³ ë¦¬
- **ì‚¬ìš©ì ì§€ì›:** ë¬´ì œí•œ ë™ì‹œ ì ‘ì†

---

## ğŸ’¡ í•µì‹¬ ì°¨ë³„ì 

1. **ê°œì¸í™”ëœ ì•ˆì „ì„±:** ì•Œë ˆë¥´ê¸° í”„ë¡œí•„ ê¸°ë°˜ 100% ì•ˆì „ ì¶”ì²œ
2. **ì‹¤ì‹œê°„ AI ìƒë‹´:** ìš”ë¦¬ ê³¼ì • ì¤‘ ì¦‰ì‹œ ë„ì›€
3. **ë¡œì»¬ LLM:** ê°œì¸ì •ë³´ ë³´í˜¸ + ë¹ ë¥¸ ì‘ë‹µ
4. **ëŒ€ìš©ëŸ‰ ê²€ìƒ‰:** 23ë§Œê°œ ë ˆì‹œí”¼ ì‹¤ì‹œê°„ ê²€ìƒ‰
5. **ë‹¤êµ­ì–´ ì§€ì›:** í•œì˜ ìë™ ë²ˆì—­

**ì´ ì‹œìŠ¤í…œì€ ë‹¨ìˆœí•œ ë ˆì‹œí”¼ ê²€ìƒ‰ì„ ë„˜ì–´ì„œ, ê°œì¸ì˜ ê±´ê°•ê³¼ ì•ˆì „ì„ ê³ ë ¤í•œ ì§€ëŠ¥í˜• ìš”ë¦¬ ë„ìš°ë¯¸ì…ë‹ˆë‹¤.**
